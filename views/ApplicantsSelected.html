<!DOCTYPE html>
<html>
  <head>
    <title>Display Users with Hotspot</title>
  </head>
  <body>
    <h1>Display Users with Hotspot</h1>

    <!-- Dropdown to select location -->
    <label for="locations">Select Location:</label>
    <select id="locations" onchange="updateHotspots()">
      <option value="">Select Location...</option>
      <option value="premnagar_market">Premnagar</option>
      <option value="ballupur_chowk">Ballupur</option>
      <option value="ghanta_ghar_market">Ghanta Ghar</option>
      <option value="rajpur_road">Rajpur Road</option>
    </select>

    <!-- Dropdown to select hotspot based on location selection -->
    <label for="hotspots">Select Hotspot:</label>
    <select id="hotspots">
      <option value="">Select Hotspot...</option>
    </select>

    <label for="selectedDate">Select Date :</label>
    <input type="date" id="selectedDate" />

    <!-- Display area for users who got the selected hotspot -->
    <div id="userList"></div>

    <!-- Submit button to fetch data -->
    <button onclick="fetchUserData()">Fetch Data</button>

    <script>
      // Hotspot data based on locations
      const hotspotsData = {
        premnagar_market: ["hotspot1", "hotspot2", "hotspot3"],
        ballupur_chowk: ["hotspot1", "hotspot2", "hotspot3"],
        ghanta_ghar_market: ["Hotspot X", "Hotspot Y", "Hotspot Z"],
        rajpur_road: ["Hotspot i", "Hotspot ii", "Hotspot iii"],
      };

      // Function to update hotspots dropdown based on selected location
      function updateHotspots() {
        const locationsDropdown = document.getElementById("locations");
        const hotspotsDropdown = document.getElementById("hotspots");
        const selectedLocation = locationsDropdown.value;

        // Clear previous options
        hotspotsDropdown.innerHTML =
          '<option value="">Select Hotspot...</option>';

        if (selectedLocation && hotspotsData[selectedLocation]) {
          const hotspots = hotspotsData[selectedLocation];
          hotspots.forEach((hotspot) => {
            const option = document.createElement("option");
            option.value = hotspot;
            option.text = hotspot;
            hotspotsDropdown.appendChild(option);
          });
        }
      }

      var selectedHotspot;
      document
        .getElementById("hotspots")
        .addEventListener("change", function () {
          selectedHotspot = this.value;
        });

      // Function to fetch user data when submit button is clicked
      function fetchUserData() {
        const selectedLocation = document.getElementById("locations").value;
        const userListDiv = document.getElementById("userList");

        const date = document.getElementById("selectedDate").value;

        // Fetch users based on selected location
        fetch(`/getUsers?location=${selectedLocation}`)
          .then((response) => response.json())
          .then((users) => {

            console.log("users",users);
            // Filter users based on selected hotspot

            const filteredUsers = users.filter(
              (user) =>
                user.hotspot === selectedHotspot &&
                user.selectedDate === date
            );

            // Find the user with the highest bidding among the filtered users
            let highestBidUser = { amount: 0 }; // Initial user with 0 bidding amount
            filteredUsers.forEach((user) => {
              const bidAmount = parseFloat(user.amount);
              if (bidAmount > highestBidUser.amount) {
                highestBidUser = user;
              }
            });

            // Display details of the user with the highest bidding for the selected hotspot
            let userDetailsHTML = `<h3>Highest Bidder at ${selectedHotspot}:</h3>`;
            if (highestBidUser._id) {
              userDetailsHTML += `
              <p>Name: ${highestBidUser.name}</p>
              <p>Age: ${highestBidUser.age}</p>
              <p>Contact Number: ${highestBidUser.contact_number}</p>
              <!-- Display other details as needed -->
            `;
            } else {
              userDetailsHTML += `<p>No highest bidder found for ${selectedHotspot}</p>`;
            }

            // Display the user details in userDetailsDiv
            userListDiv.innerHTML = userDetailsHTML;
          })
          .catch((error) => {
            console.error("Error fetching users:", error);
          });
      }
    </script>
  </body>
</html>
